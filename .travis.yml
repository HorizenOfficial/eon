os: linux
dist: jammy
language: generic
addons:
  apt:
    packages:
      - libxml-xpath-perl
services:
  - docker

git:
  depth: false

env:
  global:
    - PROD_RELEASE_BRANCH=main
    - DEV_RELEASE_BRANCH=development

before_script:
  - source ci/setup_env.sh
  - ci/travis_keep_alive.sh

jobs:
  include:
    - stage: Java project
      name: "Build and test java project(s)"
      script: ci/script.sh tests
      env: DOCKER_ORG='zencash' IMAGE_NAME='sc-ci-base' IMAGE_TAG='bionic_jdk-11_latest' TESTS='000'

    - stage: Docker packaging
      name: Build and publish EON docker image
      script: ci/docker.sh
      if: tag IS present
      env:
        - EVMAPP_DOCKER_IMAGE_NAME='evmapp'
        - BOOTSTRAPTOOL_DOCKER_IMAGE_NAME='bootstraptool'
